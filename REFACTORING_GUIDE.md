# üì¶ Widgets Reutilizables - Mobile Strop App

## ‚úÖ Widgets Creados y Refactorizados

Esta gu√≠a documenta todos los widgets reutilizables creados para maximizar la reutilizaci√≥n de c√≥digo y mantener la app DRY (Don't Repeat Yourself).

---

## üé® Core UI Widgets (Globales)

Ubicaci√≥n: `lib/src/core/core_ui/widgets/`

### 1. **StatusBadge** ‚úÖ
**Archivo**: `status_badge.dart`

Widget para mostrar badges de estado con colores e iconos.

**Uso**:
```dart
// Estado de incidencia
StatusBadge.incidentStatus('Abierta', isCritical: true)

// Estado de aprobaci√≥n
StatusBadge.approvalStatus('Pendiente')

// Tipo de incidencia
StatusBadge.incidentType('Avance')

// Custom
StatusBadge(
  label: 'Custom',
  backgroundColor: Colors.blue,
  textColor: Colors.white,
  icon: Icons.star,
)
```

**Variantes**:
- `incidentStatus()` - Abierta, En Progreso, Cerrada
- `approvalStatus()` - Pendiente, Aprobada, Rechazada, Asignada
- `incidentType()` - Avance, Problema, Consulta, Seguridad, Material

---

### 2. **InfoRow** ‚úÖ
**Archivo**: `info_row.dart`

Widget para mostrar filas de informaci√≥n con icono + label + valor.

**Uso**:
```dart
InfoRow(
  icon: Icons.person_outline,
  label: 'Nombre',
  value: 'Juan P√©rez',
  isValueBold: true,
  onTap: () {}, // Opcional
)

// Variante compacta (horizontal)
InfoRowCompact(
  icon: Icons.location_on,
  text: 'Ciudad de M√©xico',
  iconColor: Colors.blue,
)
```

**D√≥nde se usa**: Perfiles, Detalles, Configuraci√≥n

---

### 3. **SectionCard** ‚úÖ
**Archivo**: `section_card.dart`

Widget para secciones con t√≠tulo y contenido en Card.

**Uso**:
```dart
SectionCard(
  title: 'Informaci√≥n Personal',
  icon: Icons.person,
  child: Column(
    children: [
      InfoRow(...),
      Divider(),
      InfoRow(...),
    ],
  ),
)

// Variante para listas
SectionCardList(
  title: 'Historial',
  icon: Icons.history,
  items: [
    ListTile(...),
    ListTile(...),
  ],
  emptyWidget: Text('Sin historial'),
)
```

**D√≥nde se usa**: Detalles, Perfiles, Configuraci√≥n

---

### 4. **EmptyState** ‚úÖ
**Archivo**: `empty_state.dart`

Widget para estados vac√≠os con mensaje y acci√≥n opcional.

**Uso**:
```dart
// Gen√©rico
EmptyState.noData(
  title: 'No hay datos',
  message: 'Los datos aparecer√°n aqu√≠',
)

// Sin resultados de b√∫squeda
EmptyState.noResults(query: 'texto buscado')

// Espec√≠ficos
EmptyState.noProjects()
EmptyState.noTasks()
EmptyState.noReports(
  onCreateReport: () => context.push('/create-report'),
)

// Para usar en Slivers
SliverEmptyState(
  emptyState: EmptyState.noTasks(),
)
```

**Variantes preconstruidas**:
- `noData()` - Listas vac√≠as gen√©ricas
- `noResults()` - Sin resultados de b√∫squeda
- `noProjects()` - Sin proyectos asignados
- `noTasks()` - Sin tareas pendientes
- `noReports()` - Sin reportes creados

---

### 5. **AvatarWithInitials** ‚úÖ
**Archivo**: `avatar_with_initials.dart`

Widget para avatares con iniciales o imagen.

**Uso**:
```dart
// Con iniciales
AvatarWithInitials(
  name: 'Juan P√©rez',
  radius: 24,
  backgroundColor: Colors.blue,
)

// Con rol (color autom√°tico)
AvatarWithInitials.forRole(
  name: 'Juan P√©rez',
  role: 'Residente', // Aplica color seg√∫n rol
  imageUrl: 'https://...',
)

// Grupo de avatares
AvatarGroup(
  names: ['Juan', 'Mar√≠a', 'Pedro', 'Ana'],
  maxVisible: 3, // Muestra +1 si hay m√°s
  overlap: 0.6,
)
```

**Colores por rol**:
- Superintendente ‚Üí Morado
- Residente ‚Üí Azul
- Cabo ‚Üí Verde

**D√≥nde se usa**: Listas de usuarios, Equipos, Asignaciones

---

### 6. **AppLoading** ‚úÖ
**Archivo**: `app_loading.dart`

Widget para estados de carga.

**Uso**:
```dart
// Simple
AppLoading(message: 'Cargando proyectos...')

// Como overlay
AppLoadingOverlay(
  isLoading: isLoading,
  message: 'Guardando...',
  child: YourContent(),
)
```

---

### 7. **AppError** ‚úÖ
**Archivo**: `app_error.dart`

Widget para mostrar errores con retry.

**Uso**:
```dart
AppError(
  message: 'No se pudo cargar los datos',
  onRetry: () => provider.reload(),
)
```

---

### 8. **ResponsiveLayout** ‚úÖ (Refactorizado - Solo M√≥vil)
**Archivo**: `responsive_layout.dart`

Widget para layouts responsivos **SOLO M√ìVIL** (eliminado c√≥digo web/desktop).

**Uso**:
```dart
ResponsiveLayout(
  mobileBody: MobileLayout(),
  tabletBody: TabletLayout(), // Opcional
)

// Helpers
final deviceType = getMobileDeviceType(context); // phone o tablet
final isLandscape = isLandscape(context);

// Tama√±os responsivos
ResponsiveSize.text(
  context,
  phone: 14,
  tablet: 16,
)
```

**Cambios**:
- ‚úÖ Eliminado soporte para `desktopBody`
- ‚úÖ Enum cambi√≥ de `DeviceType` a `MobileDeviceType` (phone, tablet)
- ‚úÖ Breakpoint: 600dp (est√°ndar Material Design)

---

## üéØ Incidents Feature Widgets

Ubicaci√≥n: `lib/src/features/incidents/presentation/widgets/`

### 9. **IncidentHeader** ‚úÖ
**Archivo**: `incident_header.dart`

Header completo para mostrar informaci√≥n inalterable de una incidencia.

**Uso**:
```dart
IncidentHeader(
  type: 'Avance',
  title: 'Avance de Obra',
  description: 'Se complet√≥ el 80% del piso 3',
  authorName: 'Juan P√©rez',
  reportedDate: DateTime.now(),
  location: 'Piso 3, Sector A',
  isCritical: false,
)
```

**Incluye**:
- Badge de tipo
- T√≠tulo y descripci√≥n
- Metadata (autor, fecha, ubicaci√≥n)
- Banner de cr√≠tica (si aplica)

---

### 10. **TimelineEvent** ‚úÖ
**Archivo**: `timeline_event.dart`

Eventos de timeline con iconos y l√≠neas conectoras.

**Uso**:
```dart
// Constructores espec√≠ficos
TimelineEvent.assignment(
  assignedBy: 'Residente G.',
  assignedTo: 'Cabo P.',
  timestamp: DateTime.now(),
)

TimelineEvent.comment(
  author: 'Juan',
  comment: 'Todo listo',
  timestamp: DateTime.now(),
)

TimelineEvent.closed(
  closedBy: 'Cabo P.',
  closeNote: 'Trabajo completado',
  timestamp: DateTime.now(),
)

TimelineEvent.approval(
  approver: 'D/A',
  status: 'Aprobada',
  reason: 'Cumple especificaciones',
  timestamp: DateTime.now(),
)

TimelineEvent.correction(
  author: 'Cabo P.',
  explanation: 'Correcci√≥n en cantidad',
  timestamp: DateTime.now(),
)

// Timeline completa
Timeline(
  events: [
    TimelineEvent.assignment(...),
    TimelineEvent.comment(...),
    TimelineEvent.closed(...),
  ],
  emptyWidget: Text('Sin actividad'),
)
```

**D√≥nde se usa**: Historial de incidencias, Actividad del proyecto

---

### 11. **TeamMemberCard** ‚úÖ
**Archivo**: `team_member_card.dart`

Card para mostrar miembros del equipo.

**Uso**:
```dart
TeamMemberCard(
  name: 'Juan P√©rez',
  email: 'juan@strop.com',
  role: 'Residente',
  phone: '+52 123 456 7890',
  imageUrl: 'https://...',
  onCall: () => _makeCall(phone),
)
```

---

### 12. **RoleSection** ‚úÖ
**Archivo**: `team_member_card.dart`

Secci√≥n de roles con header coloreado.

**Uso**:
```dart
RoleSection(
  roleTitle: 'Residentes',
  roleColor: Colors.blue,
  members: [
    TeamMemberCard(...),
    TeamMemberCard(...),
  ],
)
```

**D√≥nde se usa**: ProjectTeamScreen

---

### 13. **IncidentListItem** ‚úÖ (Ya exist√≠a)
**Archivo**: `incident_list_item.dart`

Card para listas de incidencias.

**Uso**:
```dart
IncidentListItem(
  title: 'Reparar fuga',
  type: 'Problema',
  author: 'Juan P√©rez',
  assignedTo: 'Pedro L√≥pez',
  reportedDate: DateTime.now(),
  status: 'Abierta',
  isCritical: true,
  onTap: () => context.push('/incident/123'),
)
```

---

## üìä Home Feature Widgets

### 14. **ProjectCard** ‚úÖ (Ya exist√≠a)
**Archivo**: `project_card.dart`

Card para mostrar proyectos.

**Uso**:
```dart
ProjectCard(
  project: projectEntity,
  onTap: () => context.push('/project/${project.id}'),
  isArchived: false,
)
```

---

## üéØ Patrones de Uso

### Patr√≥n 1: Estados de Lista
```dart
Consumer<DataProvider>(
  builder: (context, provider, _) {
    // Loading
    if (provider.isLoading) {
      return AppLoading(message: 'Cargando...');
    }

    // Error
    if (provider.error != null) {
      return AppError(
        message: provider.error!,
        onRetry: () => provider.reload(),
      );
    }

    // Empty
    if (provider.data.isEmpty) {
      return EmptyState.noData(
        title: 'No hay datos',
        onAction: () => provider.create(),
      );
    }

    // Data
    return ListView.builder(
      itemCount: provider.data.length,
      itemBuilder: (context, index) {
        return DataCard(data: provider.data[index]);
      },
    );
  },
)
```

### Patr√≥n 2: Detalles con Secciones
```dart
SingleChildScrollView(
  child: Column(
    children: [
      // Header inalterable
      IncidentHeader(...),

      SizedBox(height: 24),

      // Estado
      StatusBadge.incidentStatus(status),

      SizedBox(height: 24),

      // Secciones
      SectionCard(
        title: 'Evidencia',
        icon: Icons.photo,
        child: PhotoGallery(...),
      ),

      SectionCard(
        title: 'Historial',
        icon: Icons.history,
        child: Timeline(events: events),
      ),
    ],
  ),
)
```

### Patr√≥n 3: Responsive Layout
```dart
ResponsiveLayout(
  mobileBody: SingleChildScrollView(
    child: Column(children: [...]),
  ),
  tabletBody: Row(
    children: [
      Expanded(child: LeftPanel()),
      Expanded(child: RightPanel()),
    ],
  ),
)
```

---

## üìù Gu√≠a de Migraci√≥n

### Antes (C√≥digo repetido)
```dart
// En incident_detail_screen.dart
Container(
  padding: EdgeInsets.all(12),
  decoration: BoxDecoration(
    color: Colors.blue,
    borderRadius: BorderRadius.circular(20),
  ),
  child: Text('Abierta'),
)

// En my_tasks_screen.dart
Container(
  padding: EdgeInsets.all(12),
  decoration: BoxDecoration(
    color: Colors.blue,
    borderRadius: BorderRadius.circular(20),
  ),
  child: Text('Abierta'),
)
```

### Despu√©s (Reutilizable)
```dart
// En ambos screens
StatusBadge.incidentStatus('Abierta')
```

---

## ‚úÖ Checklist de Refactorizaci√≥n

- [x] Crear StatusBadge (estados, tipos, aprobaciones)
- [x] Crear InfoRow (filas de informaci√≥n)
- [x] Crear SectionCard (secciones con t√≠tulo)
- [x] Crear EmptyState (con variantes preconstruidas)
- [x] Crear AvatarWithInitials (con grupos)
- [x] Crear IncidentHeader (header completo)
- [x] Crear TimelineEvent (con constructores espec√≠ficos)
- [x] Crear TeamMemberCard (miembros de equipo)
- [x] Crear RoleSection (secciones de roles)
- [x] Refactorizar ResponsiveLayout (eliminar web/desktop)
- [x] Eliminar c√≥digo no-m√≥vil
- [x] Exportar en barrel file (widgets.dart)
- [x] Documentar patrones de uso

---

## üöÄ Pr√≥ximos Pasos

1. **Aplicar widgets en screens existentes** ‚è≥
   - Refactorizar incident_detail_screen.dart
   - Refactorizar project_team_screen.dart
   - Refactorizar my_tasks_screen.dart
   - Refactorizar my_reports_screen.dart

2. **Crear tests unitarios** ‚è≥
   - Tests para cada widget
   - Golden tests para visuales

3. **Optimizar performance** ‚è≥
   - Const constructors donde sea posible
   - Memoizaci√≥n de widgets complejos

---

## üìö Importaciones

Para usar los widgets:

```dart
// Core UI widgets
import 'package:mobile_strop_app/src/core/core_ui/widgets/widgets.dart';

// Incidents widgets
import 'package:mobile_strop_app/src/features/incidents/presentation/widgets/incident_header.dart';
import 'package:mobile_strop_app/src/features/incidents/presentation/widgets/timeline_event.dart';
import 'package:mobile_strop_app/src/features/incidents/presentation/widgets/team_member_card.dart';
```

---

## üéØ Beneficios

‚úÖ **DRY**: No m√°s c√≥digo duplicado  
‚úÖ **Consistencia**: UI uniforme en toda la app  
‚úÖ **Mantenibilidad**: Cambios en un solo lugar  
‚úÖ **Testabilidad**: Widgets aislados y testeables  
‚úÖ **Documentaci√≥n**: Patrones claros de uso  
‚úÖ **Performance**: Widgets optimizados con const  
‚úÖ **Escalabilidad**: F√°cil agregar nuevas variantes  

---

**√öltima actualizaci√≥n**: Octubre 2025  
**Autor**: Refactorizaci√≥n Arquitectura V5
